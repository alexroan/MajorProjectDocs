%\addcontentsline{toc}{chapter}{Development Process}
\chapter{Design}

You should concentrate on the more important aspects of the design. It is essential that an overview is presented before going into detail. As well as describing the design adopted it must also explain what other designs were considered and why they were rejected.

The design should describe what you expected to do, and might also explain areas that you had to revise after some investigation.

Typically, for an object-oriented design, the discussion will focus on the choice of objects and classes and the allocation of methods to classes. The use made of reusable components should be described and their source referenced. Particularly important decisions concerning data structures usually affect the architecture of a system and so should be described here.
 
You should also identify any support tools that you used. You should discuss your choice of implementation tools - programming language, compilers, database management system, program development environment, etc. 

\section{Overview}
\section{Technologies}
	\subsection{PHP}
		PHP is used as the main language for the object oriented controlling of the data flow to and from the database. It is also used as the language to dynamically display produce the website output that the user sees.
		
	\subsection{JQuery}
		JQuery is featured on the website as a means of displaying certain features. Graphical maps generated by Google Directions \cite{google_directions_api} service are retrieved and displayed using JQuery. It is also used on the messages page of the site.	
			
	\subsection{PostgreSQL Database}
	Using an Object Relational database management system is the most efficient method of storing dynamic for websites. The PSQL database is handled by the object oriented PHP application that is used by the website.
	
	\subsection{Github}
		Github \cite{github} version control web hosting was chosen as the desired.
		
	\subsection{Programming Environment}
	
		 
\section{Overall Architecture}
	\subsection{Overview}	
		The data storage system the website uses is a PostgreSQL database which contains the following tables:
		\begin{itemize}
		\item Person - Personal details of each user.
		\item Journey - Details of Journeys that users have posted.
		\item Journey\textunderscore Step - Each journey has many journey steps. This table holds the geographical location, the related journey and the order of the step.
		\item Journey\textunderscore Step\textunderscore Temp - A temporary table used when the journey steps for a particular journey change. This may occur is a hitch request is accepted which alters the route of the journey.
		\item Hitch\textunderscore Request - Details about a hitch request made from a person to a particular journey.
		\item Message - Messages sent from user to user.
		\end{itemize}
		
		All actions performed on the database are done via a connection from the PHP database controller classes. Each table has a representative PHP model class mirroring the table. Controller classes control these classes to insert, update and delete records from each of the tables.
		
		The website instantiates the database controller classes to enable the site to produce dynamic output and allow the user to access all of the site's features once logged in.
		
	\subsection{Other Considered API Structures}
		This was not the first choice structure from the beginning. Investigative prototypes were developed that completely separated the website from an API that interacted with the database. The prospect of a procedural API was considered, prompting a basic prototype to be built. This seemed to work well but did not follow any sort of design pattern as it was not object oriented. This caused problems as it grew because of the constant reproduction of brand new code that produced very unique SQL queries. Any change in database structure resulted in a massive amount of re-factoring for the procedural API, so it was deemed that Object Oriented was the right path to follow. If the API was going to separate from the website it should probably be RESTful. This was considered in detail but deemed not right for the project because of the scale of it. If there were other methods of access that would be made available, for example mobile applications and other third party websites, REST would be a perfect solution. But because only this website would be access the API, there is no need to separate the website from the API. This is how the current structure of database controller classes and website files came to be. The website files are not object oriented and simply maintain a session whilst the user is browsing. The database controller files are object oriented and control data flow to and from the database. The website files simply instantiate database controller classes and use their methods as the user performs actions on the website.
		
	\subsection{Method}
		The waterfall software development methodology was used as the development methodology for this project. A detailed project specification document was produced to outline the key functional requirements of the final release. 
		
		A design specification document was produced to outline the key design aspects of the site, including the database and database controller classes in PHP. It also outlined how the website would communicate with these controller classes.
		
		As well as the design specification document, UML design diagrams describing the database structure and database controller structure were produced. Use case diagrams describe how users interact with the website.
		
		Agile methodologies were considered also. Feature Driven Development in particular was considered as a potential method of development, in conjunction with Test Driven Development as a coding method. However, the project specifications were so finely outlined and set in stone from the beginning, there seemed no need to choose a method which puts so much effort into dealing with changes in requirements.
		
	\subsection{Structure of Database Controller}
		The Database Controller is the name given to the object oriented structure of PHP classes used to control data flow to and from the database. For each of the main tables in the database, there is a corresponding PHP class with the same name: Hitch\textunderscore Request, Journey, Journey\textunderscore Step, Message and Person. These classes that model the tables have attributes matching those of the table attributes and contain the 4 methods: Create, Load, Update, Delete; following the CRUD persistent storage technique\cite{crud_technique}. The Create method in each of the classes uses the class attribute values to create a new entry in the corresponding database table. The Update methods update the related entry already in the corresponding table using the attributes in the class object by the primary key that will have been retrieved from the database upon executing the Create method and stored as once of the class attributes. The Load method loads the attributes to the class object from the corresponding table in the database using the primary key as a parameter. The Delete method simply deletes the related entry from the corresponding table in the database using its primary key stored in the class object's attributes. The Delete method also resets all of the attribute values in the object just in case the object is used again for a different entry in the database. All of these methods use dynamically constructed SQL queries within the method call to query the database depending on the current state of the object itself. the return value from the method depends on the success of the query to the database.
		
		Upon instantiating each of the model class objects, a non-compulsory parameter may be parsed to the constructor as the primary key to that table. If something is parsed in this parameter, the constructor will call the Load method, which attempts to populate the class object's attributes with values from the corresponding table using the parameter as the primary key.
		
		Each of the table model classes are utilized by controller classes. These classes instantiate their model classes to manipulate the entries in the database. Each of the controllers are unique to the tasks that need to be performed on each of the tables and often involve interaction between the controllers. For example, when a new Journey gets posted by a user, the Journey\textunderscore Controller class would be instantiated. This object would then instantiate a Journey class object, populate its attributes with values and use its Create method to insert the data into the database. It would then instantiate a Journey\textunderscore Step\textunderscore Controller class which in turn would instantiate and populate a series of Journey\textunderscore Step classes depending on the number of steps in that journey. Each of the entries would then be inserted into the database by the controller calling the Create method in each of the Journey\textunderscore Step objects. 		
		
\section{Website Design}
	\subsection{Overview}
		The website is produced by the collection of 25 PHP files which dynamically output HTML depending on the data that is received from the database controller classes. They also provide a platform for users to access all of the features available to them that the site offers. Other technologies and libraries are also used in the productions of the dynamic website, including Bootstrap CSS library \cite{bootstrap_css} and JQuery Library \cite{jquery_library}.
		
	\subsection{PHP}
		The PHP files responsible for dynamically outputting the website maintain a session throughout the user's time on the site. This session allows the site to maintain a user logged on as they navigate through the site. The only data that is stored continuously as a session variable is the user's email address, which is used when they log in or register to the site. If there is no session present, or the session variable containing the email is empty, any page that is accessed redirects the browser to the index page.
		
		Once logged on, there are 6 main pages accessible via the menu bar spanning the top of the web page. These pages are: 
		\begin{description}
		\item[Home] Clicking this redirects the browser to 'home.php'. This page is basically a splash page which makes 3 journey suggestions that the site thinks the user may be interested in considering to hitch a ride with. It calculates this by instantiating a 'Person' object from the database controller classes, parsing the email address stored in session to the 'Load()' method, and retrieving the details stored in the 'Person' object's attributes. If their profile has not yet been fully completed to enable predictions, the user will be prompted. Otherwise, these details are parsed into a 'Journey\textunderscore Controller' object which searches for any journeys that may be relevant to them. Each suggested journey has two buttons: 'View Journey Details' and 'Request to Hitch'. The first takes the user to a new page, 'journey\textunderscore view.php' where more details about the journey are displayed, including a map of the route. The second redirects the browser to 'request\textunderscore hitch.php' which attempts to make a request on the user's behalf and redirects the user back to 'activity.php', the Activity page.
		\item[Activity] Clicking the 'Activity' button redirects the browser to 'activity.php'. This page displays all of the current user's shared journeys on the left hand side and hitch requests on the right. If there has been any change in the status of a journey, it will be highlights red with a prompt message also in red inside it. This will occur if someone has made a hitch request to it. Journeys are retrieved from the database by the page instantiating a 'Journey\textunderscore Controller' object and parsing the email address in the session variable into the 'GetMyJourneys()' method, which returns an array of journeys posted via that email address. The hitch requests are obtained in much the same way but instead of using the 'Journey\textunderscore Controller.php' class, it instantiates a 'Hitch\textunderscore Request' object and parses the email address into the 'GetMyHitchRequests()' method. 
		
		Each journey and each hitch request are click-able if the user wishes to view them in more detail. Clicking on a journey will redirect the browser to 'journey\textunderscore view.php' which displays more details and a map relating to the route of the journey. If a hitch request is clicked it redirects the user to 'hitch\textunderscore view.php' which displays more details about the journey and driver, details of the other accepted hitchers, whether the request has been accepted or not and a map of the route including the way points that hitchers will be picked up / dropped off at.
		\item[Messages] Clicking the 'Messages' menu button will redirect the user's browser to 'messages.php'. This page allows the user to see messages sent from other users, messages sent to other user and allow them to send more. It does this by instantiating a 'Message\textunderscore Controller' object from the database controller classes and parses the email from the session variables into the 'LoadMyMessages()' method to load the messages to the object. It then calls 'GetMessages()' to retrieve them as an Array. Similarly, the same process is repeated to retrieve sent messages except instead of parse the email into the 'GetMyMessages()' method, it parsed it into the 'GetSentMessages()' method. When a new message is compiled and submitted by the site, it parses the new data fields into the 'SendMessage()' method inside the 'Message\textunderscore Controller'. This page uses JQuery 'Hide()' and 'Show()' methods to display each div. These divs include 'New Message', 'Inbox' and 'Sent Messages'. Clicking on the buttons on the left shows the corresponding div relating to the button and hides the others.
		\item[Profile] Clicking on the 'Profile' button redirects the the browser to 'profile.php'. This page retrieves the user's data by instantiating a Person object from the database controller classes, then parsing the email address in the session variable into its 'Load()' method and retrieving the attribute values. It then displays all user data on the page. The page provides a button at the bottom of the page captioned 'Edit Profile'. This button redirects the browser to the 'edit\textunderscore profile.php' page which displays all of the same information as the 'profile.php' but instead of just text, the data is displayed in editable data fields. A submit option if present at the bottom of the page which when clicked submits the form data to 'perform\textunderscore edit\textunderscore profile.php'. This page uses the 'Person' object in the database controller classes to load the person data using the email address in session, update its attributes with the posted form data and call 'Update()' in its functions to update the entry in the database. The browser is then redirected back to 'profile.php' to view the new person details.
		\item[Find a Journey] Clicking 'Find a Journey' on the menu bar will redirect the browser to 'search\textunderscore journey.php'. This page is simple a form which asks the user to input the parameters of their search. Once filled in and submitted, the input is posted to the 'perform\textunderscore journey\textunderscore search.php' page. This page instantiates a 'journey\textunderscore controller' object and sets the controller's search attributes to the search parameters posted from the form. The controller's 'SearchJourney()' method is called which returns an array of search results. These results are displayed on the page with two buttons each giving the option of immediately request to hitch, or to view more information about the journey. Clicking the 'Request Hitch' button will redirect the browser to 'request\textunderscore hitch.php' which attempts to request a hitch for that journey using a 'Hitch\textunderscore Request \textunderscore Controller' object, and parsing the email stored in the session and data relating to the journey in question into the 'CreateHitchRequest()' method. the browser is then redirected to the 'activity.php' page. if the user clicks the 'View Journey Details' button, they are redirected to 'hitch\textunderscore view.php', which uses database controller object 'Hitch\textunderscore Request\textunderscore Controller' to retrieve all data relating to the journey in question. There are two button present on the page for the user to click at this point: 'Request Hitch' and 'Find Another'. The 'Find Another' button simply redirects the browser back to the previous search results on the 'perform\textunderscore journey\textunderscore search.php' page. The 'Request Hitch' button redirects the browser to 'request\textunderscore hitch.php' which uses the database controller class 'Hitch\textunderscore Request\textunderscore Controller.php' to store the hitch request in the database and then redirects the browser back the 'activity.php' page.
		\item[Post a Journey] Clicking on the 'Post a Journey' button on the menu bar redirects the browser to 'post\textunderscore journey.php'. This page is a form, requiring the user to fill in the fields and submit the data using the button at the bottom of the form. This button posts the form data to the 'post\textunderscore journey\textunderscore preview.php' page, which using the Google Directions API \cite{google_directions_api} and JavaScript displays a preview map outlining the route so that the user may check the correct place names have been used. If the place names were not found, the user is redirected back to the form on the 'post\textunderscore journey.php' page. if the user confirms the route, the submit redirects the browser to 'perform\textunderscore journey\textunderscore post.php', which using the database controller object 'Journey\textunderscore Controller' adds the new journey to the database.
		\end{description}
		
	\subsection{Bootstrap}
		Bootstrap\cite{bootstrap_library} is a standard open source CSS library which makes the development of structures web pages easy. Bootstrap uses a mathematical based system for measuring divs across a page. It considers that every div on the page, including the base container of the whole page, is made up of 12 identically sized segments covering the width of the div. If a div inside the container is given the class 'col-lg-12', it will cover the entire width of the container. If it is given the class 'col-lg-6' it will cover half the width of the page. If inside a div given the class 'col-lg-6' is another div given the class 'col-lg-6', it will fill half of the div it lies within; where if it was given class 'col-lg-12' it would fill the whole width of the div it lies within, which could be of class 'col-lg-6' so it would only fill half of the page. Using this method enables easy segmentation and management of divs around the website.
		
		It contains a standard CSS file with the central classes with a large online repository of additional CSS files available for download for additional effects. The styles used in this project and where they are as following:
		\begin{description}
		\item['Jumbotron'] Jumbotron style was used on 'index.php'. The header across the top from this style is also maintained throughout the website on all pages.
		\item['Dashboard'] Dashboard is used as a side menu system. It was used on the 'messages.php' page along with JQuery to separate the Inbox, Sent items and New Message.
		\item['Signin'] Signin is used for form control. It is used on every page where data is entered in the style of forms: 'search\textunderscore journey.php', 'post\textunderscore journey.php' and 'index.php'.
		\end{description}
	\subsection{JavaScript and JQuery Library}
	Google maps embedding

%\section{Overall Architecture}

%\section{Some detailed design}

%\subsection{Even more detail}

%\section{User Interface}

%\section{Other relevant sections}